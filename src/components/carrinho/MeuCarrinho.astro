---
import Etapa1 from '@/components/carrinho/Etapa1.astro';
import Etapa2 from '@/components/carrinho/Etapa2.astro';
import Etapa3 from '@/components/carrinho/Etapa3.astro';

import { Icon } from 'astro-icon';
---

<!-- Botão para abrir o carrinho -->
<button class="btn abrir">Meu Carrinho<Icon class="h-6 w-6" name="mdi:cart" /></button>
<!-- MODAL: -->
<dialog id="meuCarrinho" class="modal">
  <div class="modal-box rounded-none max-h-none max-w-none w-full h-screen p-0 m-0">
    <div class="container py-8">
      <!-- Cabeçalho do carrinho onde mostra os passos e o botão de fechar -->
      <div>
        <div class="flex md:justify-between text-center flex-col-reverse md:flex-row">
          <ul class="steps">
            <!-- Passos step-primary -->

            <li id="passo1" class="step step-primary"></li>
            <li id="passo2" class="step"></li>
            <li id="passo3" class="step"></li>
          </ul>
          <div class="mb-8 mx-auto md:m-0">
            <form method="dialog" class="">
              <!-- Fechar o modal (carrinho)-->
              <button class="btn fechar">Fechar</button>
            </form>
            <!-- Fechar com botão ESC -->
            <form method="dialog" class="modal-backdrop">
              <button>close</button>
            </form>
          </div>
        </div>
        <h3 class="prose md:prose-lg font-black">Seu carrinho:</h3>
      </div>
      <!--x-->
      <!-- Corpo do Modal que será ativado de acordo com o script abaixo -->
      <Etapa1 />
      <Etapa2 />
      <Etapa3 />
      <!--x-->
    </div>
  </div>
</dialog>

<script is:inline>
// Selecione os botões das etapas

const btnEtapa1 = document.getElementById('btnEtapa1');
const btnEtapa2 = document.getElementById('btnEtapa2');
const btnEtapa3 = document.getElementById('btnEtapa3');

// Adicione event listeners a cada botão
btnEtapa1.addEventListener('click', () => {
  CarregarEtapa(1);
});

btnEtapa2.addEventListener('click', () => {
  CarregarEtapa(2);
});

btnEtapa3.addEventListener('click', () => {
  CarregarEtapa(3);
});

// Função chamada no componente Etapa*.astro
function CarregarEtapa() {
  const proxEtapa = this.target.getAttribute('data-etapa');
  console.log(3);
  // Loop etapas
  for (let i = 1; i <= 3; i++) {
    // Ativa o layout da etapa 1, 2 e 3
    const etapaCarrinho = document.getElementById(`etapa${i}`);
    // Verifica se é a etapa atual
    if (i === proxEtapa) {
      etapaCarrinho.classList.remove('hidden');
      etapaCarrinho.classList.add('flex');
    } else {
      etapaCarrinho.classList.remove('flex');
      etapaCarrinho.classList.add('hidden');
    }

    // Seta indicador de etapa 1, 2 e 3
    const passoIndicador = document.getElementById(`passo${i}`);
    // Verifica se é a etapa atual ou anterior
    if (i <= proxEtapa) {
      passoIndicador.classList.add('step-primary');
    } else {
      passoIndicador.classList.remove('step-primary');
    }
  }
}
</script>

<script is:inline>
// seleciona todos os botões com a classe abrir
const btnAbrirModal = document.querySelectorAll('button.abrir');

btnAbrirModal.forEach((button) => {
  button.addEventListener('click', () => {
    openModal();
  });
});

// seleciona todos os botões com a classe fechar
const btnFecharModal = document.querySelectorAll('button.fechar');
btnFecharModal.forEach((button) => {
  button.addEventListener('click', () => {
    closeModal();
  });
});
// Script pra fechar e abrir o modal, e remover o scroll do body
function openModal() {
  const meuCarrinho = document.getElementById('meuCarrinho');
  meuCarrinho.showModal();
  document.body.classList.add('modal-open');
}

function closeModal() {
  const meuCarrinho = document.getElementById('meuCarrinho');
  document.body.classList.remove('modal-open');
}
</script>

<style>
  body.modal-open {
    overflow: hidden;
  }
</style>
